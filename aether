#!/data/data/com.termux/files/usr/bin/bash

SHADOW="/data/data/com.termux/files/usr/share/aether-sync/shadow"

case "$1" in
    "--morph")
        echo -e "\033[1;32m[AETHER]\033[0m Engaging Absolute Stealth Isolation..."
        
        export HOME="/root"
        export USER="root"
        export PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/system/bin:/system/xbin"
        export HISTFILE=/dev/null

        INIT_CMD=$(mktemp)
        cat <<P-EOF > "$INIT_CMD"
# Prompt Masks [cite: 2026-01-26]
export PS1='\[\033[1;35m\]~#aether\[\033[0m\]\[\033[1;33m\]\${PWD#$SHADOW}\[\033[0m\]$: '
[[ "\$PS1" == *"$: "* ]] && export PS1="\${PS1//\$: / /}: "

# Absolute Isolation Logic [cite: 2026-01-29]
alias ls='l_s(){ if [[ "\$PWD" == "$SHADOW" && "\$*" == *".."* ]]; then echo "ls: cannot access '\''..'\'': Permission denied"; else command ls --color=auto "\$@"; fi; }; l_s'
alias cd='c_d(){ if [[ "\$PWD" == "$SHADOW" && ("\$1" == ".." || "\$1" == "/" || "\$1" == "../..") ]]; then builtin cd "$SHADOW"; else builtin cd "\$1" 2>/dev/null || builtin cd "$SHADOW/\$1"; fi; }; c_d'
alias whoami='echo "root"'
alias cat='command cat'

# Lockdown start
builtin cd "$SHADOW"
P-EOF

        exec /data/data/com.termux/files/usr/bin/bash --rcfile "$INIT_CMD"
    ;;

    "--export")
        echo -en "Path in Shadow: "; read F_SRC
        cp -r "$SHADOW$F_SRC" "$HOME/" 2>/dev/null && echo "Exported." [cite: 2026-01-28]
    ;;

    "--import")
        echo -en "File name: "; read F_NAME; echo -en "Dest in Shadow: "; read D_PATH
        mkdir -p "$(dirname "$SHADOW$D_PATH")"
        cp -r "$HOME/$F_NAME" "$SHADOW$D_PATH" && echo "Imported." [cite: 2026-01-26]
    ;;

    *)
        echo "Aether-Sync Core v57.0"
        echo "Usage: aether [--morph | --export | --import]"
    ;;
esac
