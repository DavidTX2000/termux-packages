#!/data/data/com.termux/files/usr/bin/bash
# AETHER-SYNC ULTRA v4.8.0 - DavidTX2000

SHADOW="/data/data/com.termux/files/usr/share/aether/shadow"
# Cores do sistema
BLUE="\033[1;34m"
RED="\033[1;31m"
GREEN="\033[1;32m"
CYAN="\033[1;36m"
YELLOW="\033[1;33m"
RESET="\033[0m"

systems_status() {
    echo -e "${BLUE}[AETHER SYSTEM REPORT]${RESET}"
    echo -e "-------------------------------"
    
    # 1. Status do Sistema Real
    if [ "$(id -u)" -eq 0 ]; then
        echo -e "Official System: ${RED}Rooted (Real)${RESET}"
    else
        echo -e "Official System: ${GREEN}Normal (Non-Root)${RESET}"
    fi

    # 2. Status do Ambiente Aether
    if [[ "$PREFIX" == *"/aether/"* ]] || [[ "$PWD" == *"$SHADOW"* ]]; then
        echo -e "Aether-Sync: ${CYAN}Emulated Root (Active)${RESET}"
    else
        echo -e "Aether-Sync: ${YELLOW}Inactive (Standby)${RESET}"
    fi
    echo -e "-------------------------------"
}

morph() {
    mkdir -p "$SHADOW"
    # Criando o .bashrc com o visual Clássico que você pediu
    cat <<OP > "$SHADOW/.bashrc"
# Prompt Clássico: ~#aether/caminho$:
export PS1='~#aether\${PWD#$SHADOW}\$: '
alias cd='_cd(){ [[ "\$1" == /* ]] && builtin cd "$SHADOW\$1" || builtin cd "\$1"; }; _cd'
alias aether='/data/data/com.termux/files/usr/bin/aether'
OP
    
    echo -e "${BLUE}[AETHER]${RESET} Warning: Low storage detected (3 GB)..."
    echo -e "${BLUE}[AETHER]${RESET} Using Virtual Link Mode..."
    echo -e "${BLUE}[AETHER]${RESET} Entering Shadow Environment..."
    
    cd "$SHADOW"
    exec bash --rcfile "$SHADOW/.bashrc" -i
}

case "$1" in
    --morph) morph ;;
    --systems)
        if [ "$2" = "-status" ]; then 
            systems_status 
        else 
            echo "Usage: aether --systems -status"
        fi
        ;;
    --stats)
        SIZE=$(du -sh "$SHADOW" 2>/dev/null | awk '{print $1}')
        echo -e "${BLUE}[AETHER]${RESET} Size: ${SIZE:-0}"
        ;;
    --kill) 
        rm -rf "$SHADOW"/* && echo "Shadow Environment Terminated." 
        ;;
    *) 
        echo "Usage: aether [--morph|--systems -status|--stats|--kill]" 
        ;;
esac
