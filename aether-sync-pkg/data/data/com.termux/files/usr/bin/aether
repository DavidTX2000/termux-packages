#!/data/data/com.termux/files/usr/bin/bash
# AETHER-SYNC v5.9.0 - Clean Edition (DavidTX2000)

SHADOW="/data/data/com.termux/files/usr/share/aether/shadow"
BLUE="\033[1;34m"
GREEN="\033[1;32m"
RESET="\033[0m"

safe_touch() {
    local target_file="$SHADOW$1"
    local dir_path=$(dirname "$target_file")
    [ -L "$dir_path" ] && rm -rf "$dir_path"
    mkdir -p "$dir_path"
    touch "$target_file" 2>/dev/null
}

morph() {
    echo -e "${BLUE}[AETHER]${RESET} Cloning Root File System..."
    ROOT_PATHS=("/acct" "/apex" "/bin" "/cache" "/config" "/data" "/dev" "/etc" "/mnt" "/odm" "/oem" "/proc" "/product" "/sdcard" "/storage" "/sys" "/system" "/system_ext" "/vendor")
    for p in "${ROOT_PATHS[@]}"; do
        if [ -d "$p" ]; then
            mkdir -p "$SHADOW$p"
            cp -as "$p"/. "$SHADOW$p/" 2>/dev/null
        fi
    done

    # Phantom Injection
    safe_touch "/proc/cpuinfo"
    safe_touch "/product/build.prop"
    mkdir -p "$SHADOW/data/data/com.whatsapp/databases"

    cat <<OP > "$SHADOW/.bashrc"
shopt -s nullglob
export PS1='~#aether\${PWD#$SHADOW}\$: '
alias cd='_cd(){ if [[ "\$1" == /* ]]; then builtin cd "$SHADOW\$1" 2>/dev/null || builtin cd "\$1"; else builtin cd "\$1"; fi; }; _cd'
alias ls='ls --color=auto -F'
alias aether='/data/data/com.termux/files/usr/bin/aether'
alias dmeta='/data/data/com.termux/files/usr/bin/dmeta'
unset TERMUX_VERSION
export PREFIX="/system"
echo -e "${GREEN}Aether-Sync Environment Active.${RESET}"
OP
    cd "$SHADOW"
    exec bash --rcfile "$SHADOW/.bashrc" -i
}

case "$1" in
    --morph) morph ;;
    --kill) rm -rf "$SHADOW"/* ;;
    *) echo "Usage: aether [--morph|--kill]" ;;
esac
